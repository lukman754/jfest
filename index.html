<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Event Data</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
  <div class="container my-5">
    <h1 class="text-center mb-4">Upcoming Events</h1>

    <!-- Filter Controls -->
    <div class="row mb-4">
      <div class="col-md-4">
        <input type="date" id="filterDate" class="form-control" placeholder="Filter by Date">
      </div>
      <div class="col-md-4">
        <select id="filterMonth" class="form-select">
          <option value="">Filter by Month</option>
          <option value="01">January</option>
          <option value="02">February</option>
          <option value="03">March</option>
          <option value="04">April</option>
          <option value="05">May</option>
          <option value="06">June</option>
          <option value="07">July</option>
          <option value="08">August</option>
          <option value="09">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
      </div>
      <div class="col-md-4">
        <input type="text" id="filterArea" class="form-control" placeholder="Filter by Area">
      </div>
    </div>

    <!-- Event Cards -->
    <div class="row" id="card-container"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const SPREADSHEET_URL = 'https://docs.google.com/spreadsheets/d/1RQ2PZMRKjBVHpG0ettmuiDjjxzpF7OfFDfXlJDT0ElE/gviz/tq?tqx=out:csv';

    fetch(SPREADSHEET_URL)
      .then(response => response.text())
      .then(data => {
        const rows = data.split('\n');
        const cardContainer = document.getElementById('card-container');

        rows.slice(1).forEach(row => {
          if (row) {
            const [tanggal, jam, lokasi, area, namaAcara, lastUpdate, linkAcara] = row.split(',');
            const card = document.createElement('div');
            card.className = 'col-md-4 mb-4';
            card.innerHTML = `
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">${namaAcara}</h5>
                  <p class="card-text">
                    <strong>Date:</strong> ${tanggal}<br>
                    <strong>Time:</strong> ${jam || '-'}<br>
                    <strong>Location:</strong> ${lokasi}<br>
                    <strong>Area:</strong> ${area}<br>
                    <small><strong>Last Update:</strong> ${lastUpdate}</small>
                  </p>
                  <a href="${linkAcara}" target="_blank" class="btn btn-primary">View Details</a>
                </div>
              </div>
            `;
            cardContainer.appendChild(card);
          }
        });

        // Filter Functionality
        document.getElementById('filterDate').addEventListener('change', () => filterCards());
        document.getElementById('filterMonth').addEventListener('change', () => filterCards());
        document.getElementById('filterArea').addEventListener('input', () => filterCards());

        function filterCards() {
          const dateFilter = document.getElementById('filterDate').value;
          const monthFilter = document.getElementById('filterMonth').value;
          const areaFilter = document.getElementById('filterArea').value.toLowerCase();

          const cards = document.querySelectorAll('#card-container .card');
          cards.forEach(card => {
            const cardDate = new Date(card.querySelector('.card-text strong').textContent.split(': ')[1]);
            const cardArea = card.querySelector('.card-text strong:last-child').textContent.split(': ')[1].toLowerCase();

            let show = true;
            if (dateFilter && cardDate.toISOString().split('T')[0] !== dateFilter) {
              show = false;
            }
            if (monthFilter && cardDate.getMonth() + 1 !== parseInt(monthFilter)) {
              show = false;
            }
            if (areaFilter && !cardArea.includes(areaFilter)) {
              show = false;
            }

            card.parentElement.style.display = show ? '' : 'none';
          });
        }
      })
      .catch(error => {
        console.error('Error:', error);
      });
  </script>
</body>

</html>
