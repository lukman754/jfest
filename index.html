<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Event</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">Event dari Google Sheet</h1>

        <!-- Filter Input -->
        <div class="row mb-4">
            <div class="col-md-4">
                <input type="date" id="filterDate" class="form-control" placeholder="Filter Tanggal">
            </div>
            <div class="col-md-4">
                <select id="filterMonth" class="form-select">
                    <option value="">Pilih Bulan</option>
                    <option value="01">Januari</option>
                    <option value="02">Februari</option>
                    <option value="03">Maret</option>
                    <option value="04">April</option>
                    <option value="05">Mei</option>
                    <option value="06">Juni</option>
                    <option value="07">Juli</option>
                    <option value="08">Agustus</option>
                    <option value="09">September</option>
                    <option value="10">Oktober</option>
                    <option value="11">November</option>
                    <option value="12">Desember</option>
                </select>
            </div>
            <div class="col-md-4">
                <button id="filterWeek" class="btn btn-primary w-100">Minggu Ini</button>
            </div>
        </div>

        <!-- Card Container -->
        <div class="row" id="card-container"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        const SPREADSHEET_URL =
            'https://docs.google.com/spreadsheets/d/1RQ2PZMRKjBVHpG0ettmuiDjjxzpF7OfFDfXlJDT0ElE/gviz/tq?tqx=out:csv';

        fetch(SPREADSHEET_URL)
            .then(response => response.text())
            .then(data => {
                const rows = data.split('\n');
                const cardContainer = document.getElementById('card-container');

                rows.slice(1).forEach(row => {
                    if (row) {
                        const [tanggal, jam, lokasi, area, namaAcara, lastUpdate, linkAcara] = row.split(',');

                        // Buat Card
                        const card = document.createElement('div');
                        card.className = 'col-md-4 mb-4';
                        card.innerHTML = `
                            <div class="card h-100">
                                <div class="card-body">
                                    <h5 class="card-title">${namaAcara}</h5>
                                    <p class="card-text">
                                        <strong>Tanggal:</strong> ${tanggal}<br>
                                        <strong>Jam:</strong> ${jam || '-'}<br>
                                        <strong>Lokasi:</strong> ${lokasi}<br>
                                        <strong>Area:</strong> ${area}<br>
                                        <small><strong>Last Update:</strong> ${lastUpdate}</small>
                                    </p>
                                    <a href="${linkAcara}" target="_blank" class="btn btn-primary">Lihat Selengkapnya</a>
                                </div>
                            </div>
                        `;
                        cardContainer.appendChild(card);
                    }
                });

                // Filter Functionality
                document.getElementById('filterDate').addEventListener('change', function () {
                    filterCards(this.value, 'date');
                });

                document.getElementById('filterMonth').addEventListener('change', function () {
                    filterCards(this.value, 'month');
                });

                document.getElementById('filterWeek').addEventListener('click', function () {
                    const today = new Date();
                    const startOfWeek = new Date(today.setDate(today.getDate() - today.getDay()));
                    const endOfWeek = new Date(today.setDate(today.getDate() + 6));

                    filterCards([startOfWeek, endOfWeek], 'week');
                });

                function filterCards(value, type) {
                    const cards = document.querySelectorAll('#card-container .card');

                    cards.forEach(card => {
                        const cardDate = new Date(card.querySelector('.card-text strong').textContent.trim());

                        let show = false;
                        if (type === 'date' && cardDate.toISOString().split('T')[0] === value) {
                            show = true;
                        } else if (type === 'month' && cardDate.getMonth() + 1 === parseInt(value)) {
                            show = true;
                        } else if (type === 'week') {
                            const [start, end] = value;
                            show = cardDate >= start && cardDate <= end;
                        }

                        card.parentElement.style.display = show ? '' : 'none';
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
    </script>
</body>

</html>
